---
title: "Day 1 \nIntroductions & (abbreviated) Foundations in R"
author: "Christopher M. Loan, MS"
date: 'February 20, 2022'
output: xaringan::moon_reader
---


```{r include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
set.seed(123)
library(tidyverse)
library(emojifont)
```

```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)

chk._ <- emoji('white_check_mark')
pkg._ <- emoji('package')
cmptr._ <- emoji('computer')
sml._ <- emoji('upside_down_face')
c._ <- emoji('car')
```

# Day 1 Agenda 

* Introduction and Overview **(9:00 am - 11:59 am)**
    * `r chk._` Introductions & KZ Lecture 
    * `r chk._` coffee break
    * `R` refresher (**up next**)
    * `ggplot2` refresher
    * Lab activity
  
* Lunch **(12:00 pm - 12:59 pm)**

* Describing and Fitting Decision Tree Models **(1:00 pm - 4:00 pm)**
    * Lecture / worked examples: Decision Trees
    * Lab activity
    * Lecture / worked examples: diving deeper
    * Summary, cons, and avenues for model improvement
    
---

# Communications Throughout

I want this to be a comfortable environment for all attendees.

I'm from another University and don't know your curricula or norms, so I want to establish that.

* Oregon & the University of Oregon are also relatively "laid back" 
* As long as you raise your hand, feel free to interrupt me if you have questions - no need to wait until the end!
* the only exception will be technical issues which concern just 1 person and not the group
* for technical issues, I'm happy to help individuals during coffee breaks and/or lunch

I'm a big fan of informal `r sml._` 

---

class: middle, center

# Packages `r pkg._` in `R`

---
# Packages `r pkg._`

In `R`, objects, functions, data, and anything besides the coding language itself need to be loaded.

These are bundled together as "packages" and placed on CRAN* for download with the built-in `install.packages()` function.

(*CRAN = the Comprehensive R Archive Network )

_____

By default, `R` has many functions loaded when you boot up.

Without default packages (or your loaded ones)

  * only `R`'s language structure would remain. 
  * even simple functions - e.g., `max()` - would be re-written every project


---

class: center, middle

# Reading in Data `R` `r cmptr._`

---

# Reading in Data

* Reading in data is really easy as long as you know the file path.
* `R` will search for your file path within the project folder. 
* File paths can get complicated in R, but using projects makes it easier.
* Running `getwd()` will tell you the working directory

```{r}
getwd()
```


---

# Examples

For this workshop, all data will be pre-loaded or formatted as `.csv` files.

___

**Packaged Data**

Data loaded from a package can be loaded with `data()`:

```{r}
library(rpart.plot)
ptitantic <- data(ptitanic)
```

___

**Import from `.csv`**

Data loaded from a `.csv` can be loaded with `read.csv()`.

I typically make a `data` folder within my `R` projects. 

```{r echo=TRUE, eval=FALSE, include=TRUE}
ex_dat <- read.csv('data/example_filename.csv')
```

The `data/` in the file name tells it that `example_file.csv` is in the `data` folder.

---

# Importing Data

Let's load some data from the World Bank (WB):

* The WB describes these as their "educational" data
* I classify them as Prevention Science data, but I'm biased `r sml._`
* In a folder called `data` within the project subfolder
* called `se_asia_imputed_world_bank.csv`


**Don't forget to store the data as an object with `<-`**
```{r echo=TRUE, eval=FALSE, include=TRUE}
dat <- read.csv('data/se_asia_imputed_world_bank.csv')
```

```{r}
# doing it this way for xaringan
dat <- read.csv(here::here('data', 'se_asia_imputed_world_bank.csv'))
```

---

# Inspecting data

* Inspecting data is as easy as running the object name.
* Before doing so, I am going to use `tibble()` to format the data frame slightly

___

## An aside re: `tibbles`

* are part of the `tidyverse` framework 
* differ very slightly from data frame (mostly beyond our scope)
* default to only printing 10 rows, which is nice for our purposes

___


(output on next page)

---

# Inspect 

It is `r nrow(dat)` observations (rows) of data on some Southeast Asian countries.

Each observation (row) has many variables (columns). 

A row represents an observation of a given country, on a given year. 

All variables in that row correspond to that country and year.


```{r}
tibble(dat)
```

---

class: center, middle

# Data Types & Structures

I am oversimplifying this section quite a bit. If you're curious on the details, see: https://cran.r-project.org/doc/manuals/r-release/R-intro.html

---

# Data Types in `R`

Computers process data based on its data type. For this workshop, you'll need to understand some data types in order to work in R:

* logical (dichotomous = TRUE/FALSE)
* numeric / double (numeric values with decimals)
* integer (whole numbers)
* characters / strings (words)

---

# Data Structures: Vectors

* vectors: represented as `c()`

  * multiple observations of one data type
  * access data in vector by its position or name (if named)
  * example: 3 run times (in seconds) for 3 different complexity models
  
```{r}
run_time_seconds <- 
  c('simple model' = 30, 
    'intermediate model' = 58, 
    'complex model' = 90)
# by position
run_time_seconds[1]
# by name
run_time_seconds['simple model']
```

---


# Data Structures: Lists


.pull-left[

```{r include = TRUE, echo = TRUE}
example_list <- 
  list(
    model = lm(data = dat, formula = se_xpd_totl_gd_zs ~ year + country_name),
    plot = plot(y = dat$se_xpd_totl_gd_zs, x = dat$year)
  )
```

```{r include = TRUE, echo = TRUE, fig.width=2, fig.height=2}
example_list[['plot']]
```

]

.pull-right[
  * conceptually the same as a vector, but more flexible
  * a way to store more general data
  * data types do not have to be the same across
  * we will use this to store models, plots, etc.
  * Refer to the object in the list with double brackets


```{r include = TRUE, echo = TRUE, fig.width=2, fig.height=2}
example_list[[2]]
```

]


---

# Data Structures: Data Frames

* data.frame / tibble 
  
  * A table
  * each cell is coded as [row_number, column_number]
  * each column can be its own data type, but must be constant within column
  * Refer to variables with `$` and name, or by position
  
```{r}
# subset first 10 observations to decrease output
iris$Species[1:10]
iris[1:10,5]
```

---

# Data Structures: Factors

* factors

    * a method of storing categorical data 
    * can store numeric data with factors to make ordered categories
    * can store character / strings to make unordered categories
    * a factor structure is thus applied to a vector to make it a factor
    * refer to a factor just as any other vector (position or name)

(example coming in 2 slides)

---

# Data Structures: Factors

* How `R` organizes categorical data
* With many models, how we handle categorical data is important
    * distributional assumptions with GLM (e.g., logistic & probit regression)
    * splitting rules with decision trees (we'll cover this later!)
* In well-written packages, factors cue the function to properly handle categorical data

Setting variables as factors is easy:

```{r}
class(dat$country_name)
dat$country_name <- factor(dat$country_name)
class(dat$country_name)
```

---

# Data Structures: Factors

* Reference category is omitted from the model
* Dummy-codes are made with all other factor levels (i.e., 0/1 value for each level)
* estimates are thus the difference between this group and the reference
* By default R uses the alpha-numerically first category (i.e., "a" or "1" etc.)


```{r}
levels(dat$country_name)[1]
```

Often, factor level is printed as a suffix to the variable name in output

```{r}
coef(lm(data = dat, formula = se_xpd_totl_gd_zs ~ country_name))
```

---

# ggplot2

GG stands for "grammar of graphics"

The basic concept is:

* observed data is mapped to several "aesthetics" 
    * `x`, `y`, `color`, `fill`, `size`, etc.
    * this concept is easiest to understand with an x and y axis
* Layers which represent those aesthetics are layered on top
    * `geom_point` = scatter plot
    * `geom_smooth` = line of best fit between `y` and `x` aesthetics
    * `geom_col` = column plot
* `ggplot2` objects are considered stacked in layers for that reason, 
* we use `+` to link layers 
* let's look at an example
---

# Mapping Aesthetics

Let's map:

* y-axis = `se_xpd_totl_gd_zs` (Government expenditure on education as percent of GDP)  
* x-axis = `year`

`ggplot2` will use observed values to choose limits to these, but no data will appear

```{r}
plot_mapping <- 
  ggplot(
    data = dat, 
    mapping = 
      aes(
        y = se_xpd_totl_gd_zs, 
        x = year
      )
  )
```


---

```{r}
plot_mapping
```


---

# `geom_point()`


```{r}
plot_mapping + geom_point()
```

---

# `geom_smooth()`

```{r}
plot_mapping + geom_point() + geom_smooth()
```


---

### `geom_smooth()` by `country_name`

```{r}
plot_mapping + geom_point() + geom_smooth() + 
  aes(color = country_name, fill = country_name) 
```

---

# Format the plot

```{r}
cleaner_plot <- 
  plot_mapping + 
  aes(color = country_name, fill = country_name) +
  geom_point() + 
  geom_smooth() +
  theme_bw(base_size = 15) + 
  scale_y_continuous(
    breaks = seq(0, 15, 3), 
    limits = c(0, 15)
  ) +
  scale_x_continuous(
    breaks = seq(2000, 2018, 3)
  ) +
  theme(
    plot.title.position = 'plot',
    plot.caption.position = 'plot',
    legend.position = c(0.5, 0.8),
    legend.direction = 'horizontal'
    )
```

---

# Add labels

```{r}
plt_labled <- 
  cleaner_plot + 
  labs(
    y = 'Government Expendature on Education (% of GDP)',
    caption = 'World Bank Education Data: 2000:2018',
    title = 'Trajectories of Government Expendature on Education (% of GDP) by Country',
    color = 'Country',
    fill = 'Country'
    ) 
```

---

```{r echo=FALSE, include=TRUE, fig.align='center', fig.width=10, fig.height=8}
plt_labled
```

---
class: center, middle

# [Exit Slides & Give `?`/Documentation Tutorial]

---
class: center, middle

# Activity

Now, it's your turn. Open `refresher_activies.Rmd` and work section 3

There are more activities after, please review the answer key after class today.